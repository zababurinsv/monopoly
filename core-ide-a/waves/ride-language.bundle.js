var RideLanguageServer=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=6)}([function(e,t,n){"use strict";var i,r,o,a,s,c,u,l,f,d,g,p,m,h,y,b,v,x,T;n.r(t),n.d(t,"Position",(function(){return i})),n.d(t,"Range",(function(){return r})),n.d(t,"Location",(function(){return o})),n.d(t,"LocationLink",(function(){return a})),n.d(t,"Color",(function(){return s})),n.d(t,"ColorInformation",(function(){return c})),n.d(t,"ColorPresentation",(function(){return u})),n.d(t,"FoldingRangeKind",(function(){return l})),n.d(t,"FoldingRange",(function(){return f})),n.d(t,"DiagnosticRelatedInformation",(function(){return d})),n.d(t,"DiagnosticSeverity",(function(){return g})),n.d(t,"Diagnostic",(function(){return p})),n.d(t,"Command",(function(){return m})),n.d(t,"TextEdit",(function(){return h})),n.d(t,"TextDocumentEdit",(function(){return y})),n.d(t,"CreateFile",(function(){return b})),n.d(t,"RenameFile",(function(){return v})),n.d(t,"DeleteFile",(function(){return x})),n.d(t,"WorkspaceEdit",(function(){return T})),n.d(t,"WorkspaceChange",(function(){return V})),n.d(t,"TextDocumentIdentifier",(function(){return C})),n.d(t,"VersionedTextDocumentIdentifier",(function(){return E})),n.d(t,"TextDocumentItem",(function(){return S})),n.d(t,"MarkupKind",(function(){return w})),n.d(t,"MarkupContent",(function(){return k})),n.d(t,"CompletionItemKind",(function(){return _})),n.d(t,"InsertTextFormat",(function(){return O})),n.d(t,"CompletionItem",(function(){return R})),n.d(t,"CompletionList",(function(){return P})),n.d(t,"MarkedString",(function(){return I})),n.d(t,"Hover",(function(){return A})),n.d(t,"ParameterInformation",(function(){return D})),n.d(t,"SignatureInformation",(function(){return L})),n.d(t,"DocumentHighlightKind",(function(){return N})),n.d(t,"DocumentHighlight",(function(){return $})),n.d(t,"SymbolKind",(function(){return j})),n.d(t,"SymbolInformation",(function(){return F})),n.d(t,"DocumentSymbol",(function(){return H})),n.d(t,"CodeActionKind",(function(){return z})),n.d(t,"CodeActionContext",(function(){return M})),n.d(t,"CodeAction",(function(){return B})),n.d(t,"CodeLens",(function(){return K})),n.d(t,"FormattingOptions",(function(){return W})),n.d(t,"DocumentLink",(function(){return Y})),n.d(t,"EOL",(function(){return X})),n.d(t,"TextDocument",(function(){return q})),n.d(t,"TextDocumentSaveReason",(function(){return J})),function(e){e.create=function(e,t){return{line:e,character:t}},e.is=function(e){var t=e;return Q.objectLiteral(t)&&Q.number(t.line)&&Q.number(t.character)}}(i||(i={})),function(e){e.create=function(e,t,n,r){if(Q.number(e)&&Q.number(t)&&Q.number(n)&&Q.number(r))return{start:i.create(e,t),end:i.create(n,r)};if(i.is(e)&&i.is(t))return{start:e,end:t};throw new Error("Range#create called with invalid arguments["+e+", "+t+", "+n+", "+r+"]")},e.is=function(e){var t=e;return Q.objectLiteral(t)&&i.is(t.start)&&i.is(t.end)}}(r||(r={})),function(e){e.create=function(e,t){return{uri:e,range:t}},e.is=function(e){var t=e;return Q.defined(t)&&r.is(t.range)&&(Q.string(t.uri)||Q.undefined(t.uri))}}(o||(o={})),function(e){e.create=function(e,t,n,i){return{targetUri:e,targetRange:t,targetSelectionRange:n,originSelectionRange:i}},e.is=function(e){var t=e;return Q.defined(t)&&r.is(t.targetRange)&&Q.string(t.targetUri)&&(r.is(t.targetSelectionRange)||Q.undefined(t.targetSelectionRange))&&(r.is(t.originSelectionRange)||Q.undefined(t.originSelectionRange))}}(a||(a={})),function(e){e.create=function(e,t,n,i){return{red:e,green:t,blue:n,alpha:i}},e.is=function(e){var t=e;return Q.number(t.red)&&Q.number(t.green)&&Q.number(t.blue)&&Q.number(t.alpha)}}(s||(s={})),function(e){e.create=function(e,t){return{range:e,color:t}},e.is=function(e){var t=e;return r.is(t.range)&&s.is(t.color)}}(c||(c={})),function(e){e.create=function(e,t,n){return{label:e,textEdit:t,additionalTextEdits:n}},e.is=function(e){var t=e;return Q.string(t.label)&&(Q.undefined(t.textEdit)||h.is(t))&&(Q.undefined(t.additionalTextEdits)||Q.typedArray(t.additionalTextEdits,h.is))}}(u||(u={})),function(e){e.Comment="comment",e.Imports="imports",e.Region="region"}(l||(l={})),function(e){e.create=function(e,t,n,i,r){var o={startLine:e,endLine:t};return Q.defined(n)&&(o.startCharacter=n),Q.defined(i)&&(o.endCharacter=i),Q.defined(r)&&(o.kind=r),o},e.is=function(e){var t=e;return Q.number(t.startLine)&&Q.number(t.startLine)&&(Q.undefined(t.startCharacter)||Q.number(t.startCharacter))&&(Q.undefined(t.endCharacter)||Q.number(t.endCharacter))&&(Q.undefined(t.kind)||Q.string(t.kind))}}(f||(f={})),function(e){e.create=function(e,t){return{location:e,message:t}},e.is=function(e){var t=e;return Q.defined(t)&&o.is(t.location)&&Q.string(t.message)}}(d||(d={})),function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4}(g||(g={})),function(e){e.create=function(e,t,n,i,r,o){var a={range:e,message:t};return Q.defined(n)&&(a.severity=n),Q.defined(i)&&(a.code=i),Q.defined(r)&&(a.source=r),Q.defined(o)&&(a.relatedInformation=o),a},e.is=function(e){var t=e;return Q.defined(t)&&r.is(t.range)&&Q.string(t.message)&&(Q.number(t.severity)||Q.undefined(t.severity))&&(Q.number(t.code)||Q.string(t.code)||Q.undefined(t.code))&&(Q.string(t.source)||Q.undefined(t.source))&&(Q.undefined(t.relatedInformation)||Q.typedArray(t.relatedInformation,d.is))}}(p||(p={})),function(e){e.create=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r={title:e,command:t};return Q.defined(n)&&n.length>0&&(r.arguments=n),r},e.is=function(e){var t=e;return Q.defined(t)&&Q.string(t.title)&&Q.string(t.command)}}(m||(m={})),function(e){e.replace=function(e,t){return{range:e,newText:t}},e.insert=function(e,t){return{range:{start:e,end:e},newText:t}},e.del=function(e){return{range:e,newText:""}},e.is=function(e){var t=e;return Q.objectLiteral(t)&&Q.string(t.newText)&&r.is(t.range)}}(h||(h={})),function(e){e.create=function(e,t){return{textDocument:e,edits:t}},e.is=function(e){var t=e;return Q.defined(t)&&E.is(t.textDocument)&&Array.isArray(t.edits)}}(y||(y={})),function(e){e.create=function(e,t){var n={kind:"create",uri:e};return void 0===t||void 0===t.overwrite&&void 0===t.ignoreIfExists||(n.options=t),n},e.is=function(e){var t=e;return t&&"create"===t.kind&&Q.string(t.uri)&&(void 0===t.options||(void 0===t.options.overwrite||Q.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||Q.boolean(t.options.ignoreIfExists)))}}(b||(b={})),function(e){e.create=function(e,t,n){var i={kind:"rename",oldUri:e,newUri:t};return void 0===n||void 0===n.overwrite&&void 0===n.ignoreIfExists||(i.options=n),i},e.is=function(e){var t=e;return t&&"rename"===t.kind&&Q.string(t.oldUri)&&Q.string(t.newUri)&&(void 0===t.options||(void 0===t.options.overwrite||Q.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||Q.boolean(t.options.ignoreIfExists)))}}(v||(v={})),function(e){e.create=function(e,t){var n={kind:"delete",uri:e};return void 0===t||void 0===t.recursive&&void 0===t.ignoreIfNotExists||(n.options=t),n},e.is=function(e){var t=e;return t&&"delete"===t.kind&&Q.string(t.uri)&&(void 0===t.options||(void 0===t.options.recursive||Q.boolean(t.options.recursive))&&(void 0===t.options.ignoreIfNotExists||Q.boolean(t.options.ignoreIfNotExists)))}}(x||(x={})),function(e){e.is=function(e){var t=e;return t&&(void 0!==t.changes||void 0!==t.documentChanges)&&(void 0===t.documentChanges||t.documentChanges.every((function(e){return Q.string(e.kind)?b.is(e)||v.is(e)||x.is(e):y.is(e)})))}}(T||(T={}));var C,E,S,w,k,_,O,R,P,I,A,D,L,N,$,j,F,U=function(){function e(e){this.edits=e}return e.prototype.insert=function(e,t){this.edits.push(h.insert(e,t))},e.prototype.replace=function(e,t){this.edits.push(h.replace(e,t))},e.prototype.delete=function(e){this.edits.push(h.del(e))},e.prototype.add=function(e){this.edits.push(e)},e.prototype.all=function(){return this.edits},e.prototype.clear=function(){this.edits.splice(0,this.edits.length)},e}(),V=function(){function e(e){var t=this;this._textEditChanges=Object.create(null),e&&(this._workspaceEdit=e,e.documentChanges?e.documentChanges.forEach((function(e){if(y.is(e)){var n=new U(e.edits);t._textEditChanges[e.textDocument.uri]=n}})):e.changes&&Object.keys(e.changes).forEach((function(n){var i=new U(e.changes[n]);t._textEditChanges[n]=i})))}return Object.defineProperty(e.prototype,"edit",{get:function(){return this._workspaceEdit},enumerable:!0,configurable:!0}),e.prototype.getTextEditChange=function(e){if(E.is(e)){if(this._workspaceEdit||(this._workspaceEdit={documentChanges:[]}),!this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");var t=e;if(!(i=this._textEditChanges[t.uri])){var n={textDocument:t,edits:r=[]};this._workspaceEdit.documentChanges.push(n),i=new U(r),this._textEditChanges[t.uri]=i}return i}if(this._workspaceEdit||(this._workspaceEdit={changes:Object.create(null)}),!this._workspaceEdit.changes)throw new Error("Workspace edit is not configured for normal text edit changes.");var i;if(!(i=this._textEditChanges[e])){var r=[];this._workspaceEdit.changes[e]=r,i=new U(r),this._textEditChanges[e]=i}return i},e.prototype.createFile=function(e,t){this.checkDocumentChanges(),this._workspaceEdit.documentChanges.push(b.create(e,t))},e.prototype.renameFile=function(e,t,n){this.checkDocumentChanges(),this._workspaceEdit.documentChanges.push(v.create(e,t,n))},e.prototype.deleteFile=function(e,t){this.checkDocumentChanges(),this._workspaceEdit.documentChanges.push(x.create(e,t))},e.prototype.checkDocumentChanges=function(){if(!this._workspaceEdit||!this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.")},e}();!function(e){e.create=function(e){return{uri:e}},e.is=function(e){var t=e;return Q.defined(t)&&Q.string(t.uri)}}(C||(C={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){var t=e;return Q.defined(t)&&Q.string(t.uri)&&(null===t.version||Q.number(t.version))}}(E||(E={})),function(e){e.create=function(e,t,n,i){return{uri:e,languageId:t,version:n,text:i}},e.is=function(e){var t=e;return Q.defined(t)&&Q.string(t.uri)&&Q.string(t.languageId)&&Q.number(t.version)&&Q.string(t.text)}}(S||(S={})),function(e){e.PlainText="plaintext",e.Markdown="markdown"}(w||(w={})),function(e){e.is=function(t){var n=t;return n===e.PlainText||n===e.Markdown}}(w||(w={})),function(e){e.is=function(e){var t=e;return Q.objectLiteral(e)&&w.is(t.kind)&&Q.string(t.value)}}(k||(k={})),function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25}(_||(_={})),function(e){e.PlainText=1,e.Snippet=2}(O||(O={})),function(e){e.create=function(e){return{label:e}}}(R||(R={})),function(e){e.create=function(e,t){return{items:e||[],isIncomplete:!!t}}}(P||(P={})),function(e){e.fromPlainText=function(e){return e.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")},e.is=function(e){var t=e;return Q.string(t)||Q.objectLiteral(t)&&Q.string(t.language)&&Q.string(t.value)}}(I||(I={})),function(e){e.is=function(e){var t=e;return!!t&&Q.objectLiteral(t)&&(k.is(t.contents)||I.is(t.contents)||Q.typedArray(t.contents,I.is))&&(void 0===e.range||r.is(e.range))}}(A||(A={})),function(e){e.create=function(e,t){return t?{label:e,documentation:t}:{label:e}}}(D||(D={})),function(e){e.create=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r={label:e};return Q.defined(t)&&(r.documentation=t),Q.defined(n)?r.parameters=n:r.parameters=[],r}}(L||(L={})),function(e){e.Text=1,e.Read=2,e.Write=3}(N||(N={})),function(e){e.create=function(e,t){var n={range:e};return Q.number(t)&&(n.kind=t),n}}($||($={})),function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26}(j||(j={})),function(e){e.create=function(e,t,n,i,r){var o={name:e,kind:t,location:{uri:i,range:n}};return r&&(o.containerName=r),o}}(F||(F={}));var z,M,B,K,W,H=function(){};!function(e){e.create=function(e,t,n,i,r,o){var a={name:e,detail:t,kind:n,range:i,selectionRange:r};return void 0!==o&&(a.children=o),a},e.is=function(e){var t=e;return t&&Q.string(t.name)&&Q.number(t.kind)&&r.is(t.range)&&r.is(t.selectionRange)&&(void 0===t.detail||Q.string(t.detail))&&(void 0===t.deprecated||Q.boolean(t.deprecated))&&(void 0===t.children||Array.isArray(t.children))}}(H||(H={})),function(e){e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports"}(z||(z={})),function(e){e.create=function(e,t){var n={diagnostics:e};return null!=t&&(n.only=t),n},e.is=function(e){var t=e;return Q.defined(t)&&Q.typedArray(t.diagnostics,p.is)&&(void 0===t.only||Q.typedArray(t.only,Q.string))}}(M||(M={})),function(e){e.create=function(e,t,n){var i={title:e};return m.is(t)?i.command=t:i.edit=t,void 0!==n&&(i.kind=n),i},e.is=function(e){var t=e;return t&&Q.string(t.title)&&(void 0===t.diagnostics||Q.typedArray(t.diagnostics,p.is))&&(void 0===t.kind||Q.string(t.kind))&&(void 0!==t.edit||void 0!==t.command)&&(void 0===t.command||m.is(t.command))&&(void 0===t.edit||T.is(t.edit))}}(B||(B={})),function(e){e.create=function(e,t){var n={range:e};return Q.defined(t)&&(n.data=t),n},e.is=function(e){var t=e;return Q.defined(t)&&r.is(t.range)&&(Q.undefined(t.command)||m.is(t.command))}}(K||(K={})),function(e){e.create=function(e,t){return{tabSize:e,insertSpaces:t}},e.is=function(e){var t=e;return Q.defined(t)&&Q.number(t.tabSize)&&Q.boolean(t.insertSpaces)}}(W||(W={}));var Y=function(){};!function(e){e.create=function(e,t,n){return{range:e,target:t,data:n}},e.is=function(e){var t=e;return Q.defined(t)&&r.is(t.range)&&(Q.undefined(t.target)||Q.string(t.target))}}(Y||(Y={}));var q,J,X=["\n","\r\n","\r"];!function(e){e.create=function(e,t,n,i){return new Z(e,t,n,i)},e.is=function(e){var t=e;return!!(Q.defined(t)&&Q.string(t.uri)&&(Q.undefined(t.languageId)||Q.string(t.languageId))&&Q.number(t.lineCount)&&Q.func(t.getText)&&Q.func(t.positionAt)&&Q.func(t.offsetAt))},e.applyEdits=function(e,t){for(var n=e.getText(),i=function e(t,n){if(t.length<=1)return t;var i=t.length/2|0,r=t.slice(0,i),o=t.slice(i);e(r,n),e(o,n);var a=0,s=0,c=0;for(;a<r.length&&s<o.length;){var u=n(r[a],o[s]);t[c++]=u<=0?r[a++]:o[s++]}for(;a<r.length;)t[c++]=r[a++];for(;s<o.length;)t[c++]=o[s++];return t}(t,(function(e,t){var n=e.range.start.line-t.range.start.line;return 0===n?e.range.start.character-t.range.start.character:n})),r=n.length,o=i.length-1;o>=0;o--){var a=i[o],s=e.offsetAt(a.range.start),c=e.offsetAt(a.range.end);if(!(c<=r))throw new Error("Overlapping edit");n=n.substring(0,s)+a.newText+n.substring(c,n.length),r=s}return n}}(q||(q={})),function(e){e.Manual=1,e.AfterDelay=2,e.FocusOut=3}(J||(J={}));var Q,Z=function(){function e(e,t,n,i){this._uri=e,this._languageId=t,this._version=n,this._content=i,this._lineOffsets=null}return Object.defineProperty(e.prototype,"uri",{get:function(){return this._uri},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"languageId",{get:function(){return this._languageId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),e.prototype.getText=function(e){if(e){var t=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(t,n)}return this._content},e.prototype.update=function(e,t){this._content=e.text,this._version=t,this._lineOffsets=null},e.prototype.getLineOffsets=function(){if(null===this._lineOffsets){for(var e=[],t=this._content,n=!0,i=0;i<t.length;i++){n&&(e.push(i),n=!1);var r=t.charAt(i);n="\r"===r||"\n"===r,"\r"===r&&i+1<t.length&&"\n"===t.charAt(i+1)&&i++}n&&t.length>0&&e.push(t.length),this._lineOffsets=e}return this._lineOffsets},e.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var t=this.getLineOffsets(),n=0,r=t.length;if(0===r)return i.create(0,e);for(;n<r;){var o=Math.floor((n+r)/2);t[o]>e?r=o:n=o+1}var a=n-1;return i.create(a,e-t[a])},e.prototype.offsetAt=function(e){var t=this.getLineOffsets();if(e.line>=t.length)return this._content.length;if(e.line<0)return 0;var n=t[e.line],i=e.line+1<t.length?t[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)},Object.defineProperty(e.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!0,configurable:!0}),e}();!function(e){var t=Object.prototype.toString;e.defined=function(e){return void 0!==e},e.undefined=function(e){return void 0===e},e.boolean=function(e){return!0===e||!1===e},e.string=function(e){return"[object String]"===t.call(e)},e.number=function(e){return"[object Number]"===t.call(e)},e.func=function(e){return"[object Function]"===t.call(e)},e.objectLiteral=function(e){return null!==e&&"object"==typeof e},e.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)}}(Q||(Q={}))},function(e,t){e.exports=RideJS},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=n(3),o=n(5);t.ctx=new o.Context;const{types:a,functions:s,globalVariables:c,globalSuggestions:u}=o.suggestions,l=n(4);function f(e,t){let n=e.getVariable(t[0]);if(null==n||!n.type)return[];let i=m(r.isUnion(n.type)?n.type:[n.type]);for(let e=1;e<t.length-1;e++){let n=i.find(n=>n.name===t[e]&&!r.isPrimitive(n.type)&&!r.isList(n.type));if(!n)return[];r.isStruct(n.type)&&(i=n.type.fields),r.isUnion(n.type)&&(i=m(n.type))}return i}t.getVarDefinition=function(e,{line:n,character:i}){const r=t.ctx.getVariablesByPos({row:n,col:i}).reverse().find(({name:t})=>t===e);return r&&r.pos?{line:r.pos.row,character:r.pos.col}:void 0},t.getCompletionDefaultResult=e=>[...u,...a.filter(e=>r.isStruct(e.type)).map(({name:e})=>({kind:i.CompletionItemKind.Class,label:e})),...t.ctx.getVariablesByPos(e).map(e=>({label:e.name,kind:i.CompletionItemKind.Variable,detail:e.doc}))],t.getCompletionResult=e=>f(t.ctx,e).map(e=>p(e)),t.getColonOrPipeCompletionResult=(e,n)=>{let o=a.map(e=>p(e));const s=t.ctx.getContextByPos(n);let c=/\bmatch[ \t(]+\b(.+)\b[ \t)]*[{=]*/gm.exec(e.split("\n")[s.start.row]);if(null!=c&&c[1]){const e=t.ctx.getVariablesByPos(n).find(({name:e})=>e===c[1].toString());e&&e.type&&r.isUnion(e.type)&&(o=e.type.map(({typeName:e})=>({label:e,kind:i.CompletionItemKind.Class})))}return o},t.checkPostfixFunction=e=>{let n=t.ctx.getVariable(e);return s.filter(({args:e})=>{if(!e[0]||!n||!n.type)return!1;let t=n.type;if(r.isPrimitive(t)&&r.isPrimitive(e[0].type)&&t===e[0].type)return!0;if(r.isStruct(t)&&r.isStruct(e[0].type)&&t.typeName===e[0].type.typeName)return!0;if(r.isStruct(t)&&r.isUnion(e[0].type)){let n=e[0].type[0];if(r.isStruct(n)&&t.typeName===n.typeName)return!0}return!("PARAMETERIZEDUNION(List(TYPEPARAM(84), Unit))"!==e[0].type||!r.isUnion(t))&&t.some(e=>r.isStruct(e)&&"Unit"===e.typeName)})},t.getSignatureHelpResult=function(e,t){const n=(e,t,n)=>`${e}(${t.map(({name:e,type:t})=>`${e}: ${d(t)}`).join(", ")}): ${d(n)}`,i=e=>e.map(({name:e,type:t})=>({label:`${e}: ${d(t)}`}));return[...g(e).map(e=>Object.assign({},e,{args:e.args.filter((e,n)=>!(t&&0===n))})).map(({name:e,args:t,doc:r,resultType:o})=>({label:n(e,t,o),documentation:r,parameters:i(t)})),...a.filter(t=>t.name===e&&r.isStruct(t.type)).map(({name:e,type:t})=>({label:n(e,t.fields,t),parameters:i(t.fields)}))]},t.getHoverResult=function(e,n){return t.unique(f(t.ctx,n).filter(({name:t})=>t===e).map(e=>`**${e.name}**: `+t.getTypeDoc(e)).concat(t.ctx.variables.filter(({name:t})=>t===e).map(({type:e})=>e?t.getTypeDoc({name:"",type:e},!0):"Unknown")).concat(c.filter(({name:t})=>t===e).map(({doc:e})=>e)).concat(g(e).map(e=>(e=>`**${e.name}** (${e.args.length>0?`\n${e.args.map(({name:e,type:t,doc:n})=>`\n * ${`${e}: ${d(t)} - ${n}`} \n`)}\n`:" "}) : ${d(e.resultType)} \n>_${e.doc}_`)(e))).concat(a.filter(({name:t})=>t===e).map(e=>t.getTypeDoc(e))).concat(l.snippets.filter(({label:t,detail:n})=>t===e&&n).map(({detail:e})=>e||"")))},t.getWordByPos=function(e,t){let n=['"',"'","*","(",")","{","}","[","]","!","<",">","|","\\","/",".",",",":",";","&"," ","=","\t"],i=0,r=e.length;for(let i=t;i<=e.length;i++)if(~n.indexOf(e[i])){r=i;break}for(let r=t;r>=0;r--)if(~n.indexOf(e[r])){i=++r;break}return e.substring(i,r)},t.getLastArrayElement=e=>null!==e&&[...e].pop()||"";const d=e=>r.isPrimitive(e)?e:r.isList(e)?r.listToString(e):r.isStruct(e)?e.typeName:r.isUnion(e)?r.unionToString(e):"Unknown";t.getTypeDoc=(e,n)=>{const i=e.type;let o="Unknown";switch(!0){case r.isPrimitive(i):o=i;break;case r.isStruct(i):o=n?i.typeName:`**${i.typeName}**(\n- `+i.fields.map(e=>`${e.name}: ${t.getTypeDoc(e,!0)}`).join("\n- ")+"\n\n)";break;case r.isUnion(i):o=i.map(e=>r.isStruct(e)?e.typeName:e).join("|");break;case r.isList(i):o="LIST[ "+`${i.listOf.typeName||i.listOf}]`}return o};const g=e=>s.filter(({name:t})=>t===e),p=e=>{let t="";return r.isPrimitive(e.type)?t=e.type:r.isList(e.type)?t=r.listToString(e.type):r.isStruct(e.type)?t=e.type.typeName:r.isUnion(e.type)&&(t=r.unionToString(e.type)),{label:e.name,detail:t,kind:i.CompletionItemKind.Field}};function m(e){const t=[...e];let n,i=[];if(e===[]||0===t.length)return[];for(;t.length>0;)if(n=t.pop(),r.isStruct(n))i.push(n);else{if(!r.isUnion(n))return[];t.push(...n)}let o=i[0].fields;for(let e=1;e<i.length;e++)o=h(o,i[e].fields);return o}function h(e,t){let n=[],i=[];return e.forEach(e=>n.push(e.name)),t.forEach(e=>!!~n.indexOf(e.name)&&i.push(e)),i}t.intersection=m,t.getDataByRegexp=function(e,t){const n=[];let i;return e.split("\n").forEach((e,r)=>{for(;null!==(i=t.exec(e));)n.push({name:i[1],namePos:e.indexOf(i[1]),value:i[2],valuePos:e.indexOf(i[2]),row:r})}),n},t.unique=e=>{let t={};for(let n=0;n<e.length;n++){if(!e[n])continue;t[JSON.stringify(e[n])]=!0}return Object.keys(t).map(e=>JSON.parse(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=n(4),o=n(1);t.isPrimitive=e=>"string"==typeof e,t.isString=e=>"string"==typeof e,t.isStruct=e=>"object"==typeof e&&"typeName"in e,t.isList=e=>"object"==typeof e&&"listOf"in e,t.listToString=e=>`LIST[ ${t.isStruct(e.listOf)?e.listOf.typeName:e.listOf}]`,t.isUnion=e=>Array.isArray(e),t.getUnionItemName=e=>t.isStruct(e)?e.typeName:t.isList(e)?t.listToString(e):e,t.unionToString=e=>e.map(e=>t.getUnionItemName(e)).join("|"),t.letRegexp=/^[ \t]*let[ \t]+([a-zA-z][a-zA-z0-9_]*)[ \t]*=[ \t]*([^\n]+)/gm,t.caseRegexp=/\bcase[ \t]+([a-zA-z][a-zA-z0-9_]*)[ \t]*:(.*)=>*{*/gm;t.Suggestions=class{constructor(){this.types=o.getTypes(),this.functions=o.getFunctionsDoc(),this.globalVariables=o.getVarsDoc(),this.regexps={typesRegExp:/[]/,functionsRegExp:/[]/},this.globalSuggestions=[],this.updateSuggestions=(e,t)=>{const n=o.getTypes(e,t),a=o.getFunctionsDoc(e,t),s=o.getVarsDoc(e,t);this.types.length=0,this.functions.length=0,this.globalVariables.length=0,this.globalSuggestions.length=0,this.types.push(...n),this.functions.push(...a),this.globalVariables.push(...s),this.regexps.typesRegExp=new RegExp(`\\b${n.map(({name:e})=>e).join("\\b|\\b")}\\b`,"g"),this.regexps.functionsRegExp=new RegExp(`^[!]*(\\b${a.filter(({name:e})=>-1===["*","\\","/","%","+"].indexOf(e)).map(({name:e})=>e).join("\\b|\\b")}\\b)[ \\t]*\\(`),this.globalSuggestions.push(...r.directives.map(e=>({label:e,kind:i.CompletionItemKind.Reference})),...r.keywords.map(e=>({label:e,kind:i.CompletionItemKind.Keyword})),...r.snippets.map(({label:e,insertText:t})=>({label:e,insertText:t,kind:i.CompletionItemKind.Function,insertTextFormat:i.InsertTextFormat.Snippet})),...a.map(({name:e,doc:t})=>({detail:t,kind:i.CompletionItemKind.Function,label:e})))},this.updateSuggestions()}}},function(e){e.exports=JSON.parse('{"keywords":["let","true","false","if","then","else","case","func"],"directives":["{-# STDLIB_VERSION 1 #-}","{-# STDLIB_VERSION 2 #-}","{-# STDLIB_VERSION 3 #-}","{-# SCRIPT_TYPE ACCOUNT #-}","{-# SCRIPT_TYPE ASSET #-}","{-# CONTENT_TYPE DAPP #-}","{-# CONTENT_TYPE EXPRESSION #-}"],"snippets":[{"label":"ifelse","insertText":"if (${1:condition}) then $2 else $3","insertTextFormat":2},{"label":"match","insertText":"match (${1:tx}) {\\n    case t:${2:type} => $0\\n    case _ =>\\n  }","insertTextFormat":2},{"label":"base58","insertText":"base58\'$1\'","insertTextFormat":2},{"label":"base64","insertText":"base64\'$1\'","insertTextFormat":2},{"label":"base16","insertText":"base16\'$1\'","insertTextFormat":2},{"label":"FOLD","insertText":"FOLD<${1:STEP_MAX}>(${2:LIST}, ${3:ACCUMULATOR}, ${4:FUNCTION})","detail":"FOLD: list : List[A] - list of values; acc : B - accumulator, foldFunc: func(acc:B, value: A) : B - folding function, takes values from list one by one","insertTextFormat":2}]}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),r=n(2);t.suggestions=new i.Suggestions;const{regexps:o,types:a,functions:s,globalVariables:c}=t.suggestions;t.Context=class{constructor(){this.context={vars:[],start:{row:0,col:0},end:{row:0,col:0},children:[]},this.variables=[],this.text="",this.getVariable=e=>this.variables.find(({name:t})=>t===e),this.getVariablesByPos=e=>this.getVariablesRec(this.context,e),this.getContextByPos=e=>this.getContextRec(this.context,e),this.getContextRec=(e,t)=>{const n=e.children.find(({start:e,end:n})=>this.comparePos(e,n,t));return void 0!==n?this.getContextRec(n,t):e},this.getVariables=(e,t)=>[...r.getDataByRegexp(e,i.letRegexp)].map(({name:e,value:n,namePos:i})=>this.defineType(e,n,t&&i?{row:t,col:i}:void 0)),this.getChildrenVariables=(e,t)=>[...r.getDataByRegexp(e,/@(Verifier|Callable)[ \t]*\((.+)\)/g).map(e=>Object.assign({},e,{name:e.value,value:e.name})),...r.getDataByRegexp(e,i.caseRegexp),...this.getFuncArgs(e)].map(({name:e,value:n,valuePos:i})=>this.defineType(e,n,t&&i?{row:t,col:i}:void 0)),this.getExtractDoc=(e,t)=>{let n,r=e.match(/(.+)\.extract/)||e.match(/extract[ \t]*\([ \t]*([a-zA-z0-9_.()"]*)[ \t]*\)/)||[],a=t;if(r.length<2)return a;if(r[1]&&null!=(n=r[1].match(o.functionsRegExp))){let e=s.find(({name:e})=>e===n[1]).resultType;e&&i.isUnion(e)&&(a=e.filter(e=>"Unit"!==e.typeName))}else a=this.getLadderType(r[1].split("."),!0).type;return a}}updateContext(e){this.text!==e&&this.findContextDeclarations(e)}getVariablesRec(e,t){const n=e.vars,i=e.children.find(({start:e,end:n})=>this.comparePos(e,n,t));return i&&n.push(...this.getVariablesRec(i,t)),n}comparePos(e,t,n){return e.row<n.row&&t.row>n.row||(e.row===n.row&&e.col<=n.col-1||t.row===n.row&&t.col>=n.col-1)}defineType(e,t,n){t=t.replace(/#.*$/,"");let i,c,u={name:e,pos:n,type:"Unknown"};const l=this.getVariable(t);if(l)u.type=l.type;else if("NaN"!==Number(t.toString().replace(/_/g,"")).toString())u.type="Int";else if(null!=(i=t.match(/\b(base58|base64|base16)\b[ \t]*'(.*)'/)))u.type="ByteVector";else if(/.*\b&&|==|!=|>=|>\b.*/.test(t)||/\btrue|false\b/.test(t))u.type="Boolean";else if(null!=(i=t.match(/^[ \t]*"(.+)"[ \t]*/)))u.type="String";else if((c=t.split("|")).length>1)u.type={typeName:"Union",fields:r.intersection(a.filter(({name:e})=>~c.indexOf(e)).map(e=>e.type))};else if(null!=(i=t.match(o.functionsRegExp)))"extract"===i[1]?u.type=this.getExtractDoc(t,"TYPEPARAM(84)"):u.type=s.find(({name:e})=>e===i[1]).resultType;else if(null!=(i=t.match(o.typesRegExp)))u.type=a.find(e=>null!=i&&e.name===i[0]).type;else if(null!=(i=t.match(/^[ \t]*\[(.+)][ \t]*$/))){let e=r.unique(i[1].split(",").map(e=>this.defineType("",e).type));u.type=1===e.length?{listOf:e[0]}:{listOf:"any"}}else if((c=t.split(".")).length>1){const e=this.getLadderType(c);if(u.type=e.type,null!=(i=r.getLastArrayElement(c).match(o.functionsRegExp))){let e=s.find(({name:e})=>null!=i&&e===i[1]);e&&(u.type=e.resultType)}}else if("Callable"===t){let t=a.find(e=>"Invocation"===e.name);u={name:e,type:null!=t?t.type:u.type}}else if("Verifier"===t){let t=a.find(e=>"Transaction"===e.name);u={name:e,type:null!=t?t.type:u.type}}return u}getLadderType(e,t){const n=e=>t&&i.isUnion(e)?e.filter(e=>!(i.isStruct(e)&&"Unit"===e.typeName)):e;let o=this.getVariable(e[0]);if(null==o||!o.type)return{name:"Unknown",type:"Unknown"};i.isUnion(o.type)&&(o.type={typeName:"Union",fields:r.intersection(o.type)});let a={name:o.name,type:n(o.type)};for(let t=1;t<e.length;t++){let r;i.isStruct(a.type)&&(r=a.type.fields.find(n=>n.name===e[t])),r&&r.type&&(a=Object.assign({},r,{type:n(r.type)}))}return a}getContextFrame(e,t,n){let i={vars:n||[],start:{row:e.row,col:e.col},end:{row:t.length-1,col:t[t.length-1].length},children:[]},r=1,o=!1;for(let n=e.row;n<t.length;n++){let a=[];if(!~t[n].indexOf("{-#")&&!~t[n].indexOf(" #-}")){if(1===r){const e=this.getVariables(t[n],n);i.vars.push(...e),a=this.getChildrenVariables(t[n],n),this.variables.push(...e,...a)}for(let s=n===e.row?e.col+1:0;s<t[n].length;s++){if("}"===t[n][s]&&r--,"{"===t[n][s]){const e=this.getContextFrame({row:n,col:s},t,a);i.children.push(e),n=e.end.row,s=e.end.col}if(0===r){i.end.row=n,i.end.col=s+1,o=!0;break}}if(o)break}}return i}getFuncArgs(e){const t=[];return r.getDataByRegexp(e,/func[ \t]*(.*)\([ \t]*(.*)[ \t]*\)[ \t]*=[ \t]*{/g).forEach(({value:e,valuePos:n,row:i})=>e.split(/[ \t]*,[ \t]*/).forEach(r=>{const o=r.split(/[ \t]*:[ \t]*/),a=-1!==e.indexOf(r)&&n?e.indexOf(r)+n:void 0;o[0]&&o[1]&&t.push({name:o[0]||"",value:o[1]||"",valuePos:a,row:i})})),t}findContextDeclarations(e){const t=e.split("\n");this.variables.length=0,this.variables.push(...c);const n=this.getContextFrame({row:0,col:0},t,c);return this.context=n,n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=n(1),o=n(2),a=n(5);class s{validateTextDocument(e){try{const t=r.scriptInfo(e.getText());if("error"in t)throw t.error;const{stdLibVersion:n,scriptType:i}=t;a.suggestions.updateSuggestions(n,2===i)}catch(e){a.suggestions.updateSuggestions()}let t=[],n=r.compile(e.getText());if("error"in n){const r=n.error,o=/\d+-\d+/gm.exec(r)||[];if(o.length>0){const n=o.map(t=>{const[n,o]=t.split("-").map(t=>e.positionAt(parseInt(t)));return{range:i.Range.create(n,o),severity:i.DiagnosticSeverity.Error,message:r}});t.push(...n)}else{const e=/:(\d+):(\d+) ...".*"\)$/gm.exec(r)||[];isNaN(+e[1])||isNaN(+e[2])?t.push({range:i.Range.create(i.Position.create(0,0),i.Position.create(0,0)),severity:i.DiagnosticSeverity.Error,message:r}):t.push({range:i.Range.create(i.Position.create(+e[1]-1,+e[2]-1),i.Position.create(+e[1]-1,+e[2]-1)),severity:i.DiagnosticSeverity.Error,message:`Parsing error: ${r}`})}}return t}completion(e,t){const n=e.offsetAt(t),r=e.getText(),a=r.substring(n-1,n),s=e.getText({start:{line:t.line,character:0},end:t}),c={row:t.line,col:t.character+1};o.ctx.updateContext(r);let u=[];try{let e=s.match(/([a-zA-z0-9_]+)\.[a-zA-z0-9_]*\b$/),t=/([a-zA-z0-9_]+)\.[a-zA-z0-9_.]*$/gm.exec(s)||[];switch(!0){case"."===a||null!==e:let n=null===e?o.getLastArrayElement(s.match(/\b(\w*)\b\./g)).slice(0,-1):e[1];t.length>=2&&o.ctx.getVariable(t[1])&&(u=[...o.getCompletionResult(t[0].split(".")),...o.checkPostfixFunction(n).map(({name:e})=>({label:e}))]);break;case null!==s.match(/([a-zA-z0-9_]+)[ \t]*[|:][ \t]*[a-zA-z0-9_]*$/):u=o.getColonOrPipeCompletionResult(r,c);break;case-1!==["@"].indexOf(a):u=[{label:"Callable",kind:i.CompletionItemKind.Interface},{label:"Verifier",kind:i.CompletionItemKind.Interface}];break;default:u=o.getCompletionDefaultResult(c)}}catch(e){}return{isIncomplete:!1,items:u}}hover(e,t){const n=/[a-zA-z0-9_]+\.[a-zA-z0-9_.]*$/gm.exec(e.getText({start:{line:t.line,character:0},end:t})),i=e.getText().split("\n")[t.line],r=o.getWordByPos(i,t.character);o.ctx.updateContext(e.getText());t.line,t.character;return{contents:o.getHoverResult(r,(n?n[0]:"").split("."))}}definition(e,t){const n=e.getText(),r=n.split("\n")[t.line],a=o.getWordByPos(r,t.character),{uri:s}=e,c=o.getDataByRegexp(n,/func[ \t]*(.*)\([ \t]*(.*)[ \t]*\)[ \t]*=[ \t]*/g).find(({name:e})=>e===a);let u;return u=c&&c.namePos&&c.row?{line:c.row,character:c.namePos}:o.getVarDefinition(a,t),u?i.Location.create(s,{start:u,end:Object.assign({},u,{character:u.character+a.length})}):null}signatureHelp(e,t){const n=e.offsetAt(t),i=e.getText().substring(n-1,n),r=e.getText({start:{line:0,character:0},end:t}),a=e.getText({start:{line:t.line,character:0},end:t}),s=/[a-zA-z0-9_]+\.\b([a-zA-z0-9_]+)\b[ \t]*\(/.test(a),c=o.getLastArrayElement(r.match(/\b([a-zA-z0-9_]*)\b[ \t]*\(/g)),u=o.getLastArrayElement(r.split(c||""));let l=!1;return(")"===i||u.split(")").length>1)&&(l=!0),{activeParameter:l?null:u.split(",").length-1,activeSignature:l?null:0,signatures:l?[]:o.getSignatureHelpResult(c.slice(0,-1),s)}}completionResolve(e){return e}}s.TextDocument=i.TextDocument,t.LspService=s}]);